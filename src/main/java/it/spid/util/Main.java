package it.spid.util;

import it.spid.exception.SpidServiceException;
import it.spid.service.SPIDService;
import it.spid.service.impl.SPIDServiceImpl;
import it.spid.util.impl.LogoutDecoderImpl;
import org.opensaml.saml2.core.LogoutResponse;
import org.opensaml.xml.io.MarshallingException;
import org.opensaml.xml.io.UnmarshallingException;
import org.xml.sax.SAXException;

import javax.xml.parsers.ParserConfigurationException;
import java.io.IOException;
import java.security.KeyStoreException;
import java.security.NoSuchAlgorithmException;
import java.security.UnrecoverableEntryException;

public class Main {

    public static void main(String[] args) throws KeyStoreException, UnrecoverableEntryException, NoSuchAlgorithmException, MarshallingException, ParserConfigurationException, UnmarshallingException, SAXException, IOException, SpidServiceException {

        String alias = "test-spid";
        String password = "changeit";
        SPIDService spid = new SPIDServiceImpl();

        XmlDigitalSignature xml = new XmlDigitalSignature();
        KeyManager km = new KeyManager();

        String samlResponse = "PHNhbWxwOkxvZ291dFJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJpZF8wN2E2MzUxOGE3YzkzZjAyM2E0YmZhYjIxMmQ3N2Q3OTY2YzgxZDVlIiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAyMC0wOS0yNlQxMjo0Nzo0NloiIERlc3RpbmF0aW9uPSJodHRwOi8vbG9jYWxob3N0OjgwODAvc3BpZGl0YWxpYV93YXJfZXhwbG9kZWQvbGNzIiBJblJlc3BvbnNlVG89Il84ZjkyNTI2NC01YWEwLTQ4ZGEtYjMyMS1kMmU1NjVlZGU0OWYiPgogIDxzYW1sOklzc3VlciB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5IiBOYW1lUXVhbGlmaWVyPSJzb21ldGhpbmciPmh0dHA6Ly9sb2NhbGhvc3Q6ODA4ODwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNhLXNoYTI1NiIvPjxkczpSZWZlcmVuY2UgVVJJPSIjaWRfMDdhNjM1MThhN2M5M2YwMjNhNGJmYWIyMTJkNzdkNzk2NmM4MWQ1ZSI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+PGRzOkRpZ2VzdFZhbHVlPkxVVGxKRDgwdlprQTIxL2lsUmhyMHU4V2RHdUYvVnRtUUxLTXJOVHhYZjg9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPlNzT2x2RU4zOFVlS1J0V1ZGSC9NL2swd1VvbEtOckJ2T3FKemI4eEtQQUUwbm5OZEpJWldRU3BzMFV3U1Y3aG9iREZSVTdOQXFQbUJKcitFKzNpUVdXSndwdGlQei82Lzlhc0w5TnUzTVV6aEpnK0xxOE5LTHh1WGNhZDZST0FrTDJNV0RLYkQ3V3l0MFdnWktMUzFyR283RlZISHlVdjJ2QjVEVnVoM1VVKzVvSmdha3VnekVSZGNMVUJPY1FzSzlhMUs0Mk9vcjRHU2Y2SG4xUk1CNU1nL3VLbDJKT25sbGVtM25jZjBLb0diaXE4cDA3aGVPTHErVU9veVVhL0gydnRET1RxVkFvVjAxendlZHZzVDFtVHVVaElRQ1lyNkNOaW1mMVpBTGp6RXppSnp1bzZ0SDNES0tJQ3ZIOTFTYXdrNjlYT3d0WUFoYU1tWlFSODk3Zz09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlDK3pDQ0FlT2dBd0lCQWdJVVhpak13bDN2RDhvK05xcC9mQTdwbERVOStVb3dEUVlKS29aSWh2Y05BUUVMCkJRQXdEVEVMTUFrR0ExVUVCaE1DU1ZRd0hoY05NakF3TlRJMk1UTXlPVE16V2hjTk1qQXdOakkxTVRNeU9UTXoKV2pBTk1Rc3dDUVlEVlFRR0V3SkpWRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQgpBUGtPeWtmRzVtNjZOQU14NFVaZ0lVc3ltSCt1WlJmR1hSZEJRcm1NM0RnWG5WbXFCWHhqSVVlemFEN0xOQjhkCld3NFIwY21Wb20wVzlUWEx5V1g0REFmVUFqOHEyckZoOGpXRWVRT1JCT2p4ZHh2d3lqdzVoZ1ExTHVQSDE3RmcKQ1o1dmZxdVFnbkZsOGxFUXptN2RyMEoyNUlNOVh2TGlOaTZGbEFLMS9uOGEwWUlxaTZDYXZWUEF3MDZaV3BycApnZDFrZjg5dnY2WkcybU15WmhiWEJHbGVralA3aHVNUjFUWjJ3VXVKcWZpaVlpVXJNSEZvbnVEdEd0VURaQm9XCkZKakkxUGpoeThoZVhwN1pVcmN3bUdEZXU1SjloV2g2MTd2UVJiWjZBRCttcCtPVm90RXU5Rmt4cFgrRUhxVkYKaElWMHEzUzFsbGxsNHdPVFIwTCtRRnNDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkVwc0dyU0pJN2NKWmk0Ugp0ZWFDeWM3M1hNSnFNQjhHQTFVZEl3UVlNQmFBRkVwc0dyU0pJN2NKWmk0UnRlYUN5YzczWE1KcU1BOEdBMVVkCkV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTFdzWlRIQmdjTmxldDJWc3ozci9nL0EKQ3JmclI1aW55T1pwRjdCa0xxb3NURDRqM3o3Y3FIVjJHc1p5U3JUSHVxQVVsdi9BbVlVTXM0dlRyR2xYTUduMwpLYXJXUnNQeUY1a3k4OTROa1pyMmh2Qk82YkZucGRyMHZsTzV3Wk11bkJqeFpLVXludytvV29wN1paYWlFOUF1CmFaTHMzdTgyYUlWUVpNdXQzeXVtOG94Y0ZRSnRvTkZ2TUY2SktacldhYmJBMlM1RGdQdTk2c0pIWmVkOVJNOGMKdmFJRXlaTTI4anFsM29LS05MYUtLcnAyYWwvbUlzdzFwOUV1Rjk0Z2tkUSsvanJDQm5uRmxNcnFzQmd5amRldQpIM0J2VEk5ZkRqVXU5Rk0wRU52bHZ3Q21GeWFHMW92NkUxbFJIOGNBZlpDY0JUQVdOSHh6VUZJMjZ3cndDalk9CjwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPgogIDxzYW1scDpTdGF0dXM+CiAgICA8c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+CiAgPC9zYW1scDpTdGF0dXM+Cjwvc2FtbHA6TG9nb3V0UmVzcG9uc2U+";

        LogoutDecoderImpl decoder = new LogoutDecoderImpl(samlResponse);
        LogoutResponse req =  decoder.getLogoutResponse();
        //LogoutRequestDecoded logdec = decoder.processLogoutResponse();

        String entity = decoder.getEntityId(req);

        System.out.println(entity);







        //System.out.println(logdec.getStatus() + "   " + logdec.getInResponseTo());


    }
}